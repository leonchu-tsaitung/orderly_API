# API 架構規劃草稿

## 資料定義

### 價格表

- 一個供應商會上傳多個價格表
- 一個價格表包含適用客群代碼、有效時間區間、價格表版本代碼、一個清單包含多個價格元素

### 價格元素

- 包含品項代碼、品項名稱、品項說明(選填)、供應狀態、價格、計價單位、是否應稅
- 價格除了直接價錢外，還有「時價」即事後報價形式，時價可另外選擇填寫價格區間

### 訂單

- 一個餐廳可對每個有取得有效價格表的供應商下訂單
- 一個訂單包含下訂時間、交貨日期、本次特殊到貨時間（選填）、對應的價格表版本代碼、收貨單位、本次特殊收貨地點（選填）、一個清單包含多個需求元素、訂單狀態、菜價折抵(含稅)、菜價折抵(不含稅)、運費折抵、其他折抵（結構化，可拓展多種項目）、訂單總額

### 需求元素

- 包含品項代碼、品項名稱、訂購數量、價格、計價單位
- 價格除了直接價錢外，針對時價項目可選擇指定成交金額範圍

### 訂單狀態

- 正流程依序為
    - 建立
    - 確認
    - 出貨（可跳過）
    - 到貨（可跳過）
    - 驗收完畢
    - 結帳
- 另有特殊狀態
    - 作廢
    - 退回

## 動作定義

### 供應商端

- 價格表
    - CRUD，都以整份價格表為單位
- 訂單
    - 查詢訂單清單
    - 查詢單一訂單詳情
    - 單對單一訂單的狀態更新，一旦往下個階段就不能執行前一階段指令
        - 訂單確認，此時須將時價品項進行定價、並修改實際出貨量
            - 只能執行一次
        - 訂單出貨，可再次修改實際出貨量
            - 只能執行一次
        - 訂單到貨，不可修改資訊
    - 訂單驗收之前，接可使訂單退回
        - 訂單退回狀態可執行的行為同「建立」
    - 在訂單確認到訂單出貨之間，可進行多次「理貨更新」，每次皆可更新實際出貨量
    - 訂單驗收後可進行多次「訂單異動」，每次皆可更新實際出貨品項、實際出貨量、直接價格
    - 查詢單一訂單更新歷程

### 餐廳端

- 價格表
    - 查詢清單、查詢詳情，都以整份價格表為單位
- 訂單
    - 查詢訂單清單
    - 查詢單一訂單詳情
    - 建立訂單
    - 在訂單確認之前，可進行多次「修改訂單」，每次皆可更新需求品項、需求量
    - 在訂單確認之前，可將訂單作廢，作廢後的訂單無法進行任何更新

### 其他

- 會有一個訂單驗收的 APP，由餐廳操作，可使訂單進入驗收完畢狀態
    - 過程會更改實際出貨量
    - 同一筆訂單不能重複驗收
	
